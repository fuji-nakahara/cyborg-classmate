sudo: false

language: ruby
rvm:
  - 2.5

env:
  global:
    - JEKYLL_ENV=production
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true

cache: bundler

script:
  - bundle exec jekyll build
  - bundle exec htmlproofer ./_site --url-swap '\A\/cyborg-classmate:' --disable-external
  - bundle exec jekyll build-ebook --kindle

branches:
  only:
    - master
    - /^v\d+\.\d+\.\d+$/

deploy:
  - provider: pages
    github-token:
      secure: a9AQs1clz+s6ozVS9ET1gTBi6TdmkogViUmMOyp6g2KDxQgl7BoteKs7Cp3vFURWgyvRMj0qmanxCJ1rSxjF8ebrKcGzqZR1lp+EHFCJ6bisNY3BVrWZNLr6PuPNCul+iHOVYKRVzft2f3FN0mmdFrRJaVlrIlghUzr9Iv1QgLjaYMVQYUlJDsUr8rcTnDKZHkYPOiEVIvXtUvnUWs58C8CfWkvBCQ7+yMzIN56f1XvexGOad5m3fFjtAE/ofpJ3e7Fd+wD9dLcQWThcMAszKBdVEqZPziErjKIhZjH2uIkywQ+0Fh0X6SODEwn4ZP6LT17+YKNclwldj5gQoDDqOoJ7gBSS4YbsEJB6U4RiFmPNEgPsAks8ZRXkS6vLQtMaauYbkXYSTgVmo3idyeu2LlsWRwhHLVK0sA7QTHX7dzGhrDte4j9AOCnZXl51uHWnG7w9Tv5djx9enW5iDNUjDr6nxw5U0dPJBflibx3dDxlMnctz4wMl6bS5qqUKi3GDdxV6Rl++Dg5AgESQ4nBpwfsWZ8AGa62ojo+hFNYtxCv2SCupmHrDasOH8/EGNXevhsZVQCVzkvq6B8sK1Jx/0g1qkcdKAFSvy8wOA/s4ODf6HvUxR1POJFq6un7qYl/cvLbWgQhPv5RqZIFwsDxFDvNWbOX3lX5wCoIduDAnHr4=
    skip-cleanup: true
    local-dir: _site
    target_branch: gh-pages
    on:
      branch: master
  - provider: releases
    api_key:
      secure: a9AQs1clz+s6ozVS9ET1gTBi6TdmkogViUmMOyp6g2KDxQgl7BoteKs7Cp3vFURWgyvRMj0qmanxCJ1rSxjF8ebrKcGzqZR1lp+EHFCJ6bisNY3BVrWZNLr6PuPNCul+iHOVYKRVzft2f3FN0mmdFrRJaVlrIlghUzr9Iv1QgLjaYMVQYUlJDsUr8rcTnDKZHkYPOiEVIvXtUvnUWs58C8CfWkvBCQ7+yMzIN56f1XvexGOad5m3fFjtAE/ofpJ3e7Fd+wD9dLcQWThcMAszKBdVEqZPziErjKIhZjH2uIkywQ+0Fh0X6SODEwn4ZP6LT17+YKNclwldj5gQoDDqOoJ7gBSS4YbsEJB6U4RiFmPNEgPsAks8ZRXkS6vLQtMaauYbkXYSTgVmo3idyeu2LlsWRwhHLVK0sA7QTHX7dzGhrDte4j9AOCnZXl51uHWnG7w9Tv5djx9enW5iDNUjDr6nxw5U0dPJBflibx3dDxlMnctz4wMl6bS5qqUKi3GDdxV6Rl++Dg5AgESQ4nBpwfsWZ8AGa62ojo+hFNYtxCv2SCupmHrDasOH8/EGNXevhsZVQCVzkvq6B8sK1Jx/0g1qkcdKAFSvy8wOA/s4ODf6HvUxR1POJFq6un7qYl/cvLbWgQhPv5RqZIFwsDxFDvNWbOX3lX5wCoIduDAnHr4=
    skip_cleanup: true
    file:
      - _ebook/cyborg-classmate.epub
      - _ebook/cyborg-classmate.mobi
    on:
      tags: true
